{% extends "admin/base.html" %}

{% block title %}Bounce: {{ bounce.venue_name }}{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Bounce: {{ bounce.venue_name }}</h1>
    <a href="/admin/bounces" class="btn btn-secondary">Back to Bounces</a>
</div>

<div class="detail-grid">
    <div class="detail-card">
        <h2>Edit Bounce</h2>
        <form method="post" action="/admin/bounces/{{ bounce.id }}">
            <div class="form-group">
                <label for="venue_name">Venue Name</label>
                <input type="text" id="venue_name" name="venue_name" value="{{ bounce.venue_name }}">
            </div>

            <div class="form-group">
                <label for="status">Status</label>
                <select id="status" name="status">
                    <option value="active" {% if bounce.status == 'active' %}selected{% endif %}>Active</option>
                    <option value="archived" {% if bounce.status == 'archived' %}selected{% endif %}>Archived</option>
                </select>
            </div>

            <div class="form-group checkbox-group">
                <label>
                    <input type="checkbox" name="is_public" value="true" {% if bounce.is_public %}checked{% endif %}>
                    Public
                </label>
            </div>

            <div class="form-group checkbox-group">
                <label>
                    <input type="checkbox" name="is_now" value="true" {% if bounce.is_now %}checked{% endif %}>
                    Happening Now
                </label>
            </div>

            <button type="submit" class="btn btn-primary">Save Changes</button>
        </form>
    </div>

    <div class="detail-card">
        <h2>Bounce Info</h2>
        <dl class="info-list">
            <dt>ID</dt>
            <dd>{{ bounce.id }}</dd>

            <dt>Creator</dt>
            <dd>
                {% if bounce.creator %}
                <a href="/admin/users/{{ bounce.creator.id }}">{{ bounce.creator.nickname or 'User ' ~ bounce.creator.id }}</a>
                {% else %}
                -
                {% endif %}
            </dd>

            <dt>Venue Address</dt>
            <dd>{{ bounce.venue_address or '-' }}</dd>

            <dt>Coordinates</dt>
            <dd>{{ "%.4f"|format(bounce.latitude) }}, {{ "%.4f"|format(bounce.longitude) }}</dd>

            <dt>Place ID</dt>
            <dd class="truncate">{{ bounce.place_id or '-' }}</dd>

            <dt>Bounce Time</dt>
            <dd>{{ bounce.bounce_time.strftime('%Y-%m-%d %H:%M') if bounce.bounce_time else '-' }}</dd>

            <dt>Created</dt>
            <dd>{{ bounce.created_at.strftime('%Y-%m-%d %H:%M:%S') if bounce.created_at else '-' }}</dd>
        </dl>
    </div>
</div>

<div class="detail-section">
    <h2>Invites ({{ bounce.invites|length }})</h2>
    {% if bounce.invites %}
    <table class="data-table">
        <thead>
            <tr>
                <th>User</th>
                <th>Invited At</th>
            </tr>
        </thead>
        <tbody>
            {% for invite in bounce.invites %}
            <tr>
                <td>
                    {% if invite.user %}
                    <a href="/admin/users/{{ invite.user.id }}">{{ invite.user.nickname or 'User ' ~ invite.user.id }}</a>
                    {% else %}
                    -
                    {% endif %}
                </td>
                <td>{{ invite.created_at.strftime('%Y-%m-%d %H:%M') if invite.created_at else '-' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="text-muted">No invites</p>
    {% endif %}
</div>

<div class="detail-section">
    <h2>Attendees ({{ bounce.attendees|length }})</h2>
    {% if bounce.attendees %}
    <table class="data-table">
        <thead>
            <tr>
                <th>User</th>
                <th>Joined At</th>
                <th>Last Seen</th>
            </tr>
        </thead>
        <tbody>
            {% for attendee in bounce.attendees %}
            <tr>
                <td>
                    {% if attendee.user %}
                    <a href="/admin/users/{{ attendee.user.id }}">{{ attendee.user.nickname or 'User ' ~ attendee.user.id }}</a>
                    {% else %}
                    -
                    {% endif %}
                </td>
                <td>{{ attendee.joined_at.strftime('%Y-%m-%d %H:%M') if attendee.joined_at else '-' }}</td>
                <td>{{ attendee.last_seen_at.strftime('%Y-%m-%d %H:%M') if attendee.last_seen_at else '-' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="text-muted">No attendees</p>
    {% endif %}
</div>

<div class="danger-zone">
    <h2>Danger Zone</h2>
    <form method="post" action="/admin/bounces/{{ bounce.id }}/delete" onsubmit="return confirm('Are you sure you want to delete this bounce? This cannot be undone.')">
        <button type="submit" class="btn btn-danger">Delete Bounce</button>
    </form>
</div>
{% endblock %}
